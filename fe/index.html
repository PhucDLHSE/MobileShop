<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mobile Shop</title>
    <!-- Bootstrap CSS -->
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- FontAwesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/style.css">
</head>

<body>
    <div class="top-bar bg-primary text-white py-1">
        <div class="container d-flex justify-content-between">
            <div class="top-links">
                <a href="#">Thu cũ</a> |
                <a href="#">Lên đời</a> |
                <a href="#">Giao nhanh miễn phí</a>
            </div>
            <div class="top-right">
                <a href="#">Tải App Smember - Tích điểm & nhận ưu đãi</a>
            </div>
        </div>
    </div>

    <div class="main-header bg-danger py-2">
        <div class="container d-flex align-items-center justify-content-between">
            <div class="d-flex align-items-center">
                <div class="logo">
                    <img src="logo.png" alt="Logo">
                </div>
                <div class="dropdown mx-2">
                    <button class="btn btn-light dropdown-toggle" type="button" id="dropdownMenuButton"
                        data-bs-toggle="dropdown" aria-expanded="false">
                        Danh mục
                    </button>
                    <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton" id="categoryMenu">
                        <!-- Các danh mục sẽ được tải động từ API -->
                    </ul>
                </div>
                <div class="location-dropdown mx-2">
                    <button class="btn btn-light dropdown-toggle" type="button" id="locationDropdown"
                        data-bs-toggle="dropdown" aria-expanded="false">
                        Xem giá tại Hồ Chí Minh
                    </button>
                    <ul class="dropdown-menu" aria-labelledby="locationDropdown">
                        <li><a class="dropdown-item" href="#">Hồ Chí Minh</a></li>
                        <li><a class="dropdown-item" href="#">Hà Nội</a></li>
                    </ul>
                </div>
            </div>
            
            <div class="search-bar mx-2 flex-grow-1 position-relative">
                <input type="text" class="form-control" placeholder="Bạn cần tìm gì?">
                <ul class="dropdown-menu" id="search-dropdown" style="position: absolute; top: 100%; transform: translateX(-50%); left: 50%; display: none; z-index: 1050;">
                    <!-- Kết quả tìm kiếm sẽ được thêm vào đây -->
                </ul>
            </div>        

            <div class="contact-info d-flex align-items-center">
                <a href="#" class="text-white mx-2"><i class="fas fa-phone-alt"></i> Gọi mua hàng 1800.2097</a>
                <a href="#" class="text-white mx-2"><i class="fas fa-map-marker-alt"></i> Cửa hàng gần bạn</a>
                <a href="#" class="text-white mx-2"><i class="fas fa-truck"></i> Tra cứu đơn hàng</a>
                <a href="#" class="text-white mx-2"><i class="fas fa-shopping-cart"></i> Giỏ hàng</a>
                <a href="login.html" class="text-white mx-2"><i class="fas fa-user"></i> Đăng nhập</a>
            </div>
        </div>
    </div>

    <!-- Left Dropend Menu -->
    <div class="container-fluid mt-3 d-flex">
        <div class="content-wrapper d-flex flex-row w-100">
            <div class="left-menu">
                <div class="btn-group-vertical w-100" role="group">
                    <div class="btn-group dropend">
                        <button type="button" class="btn btn-light dropdown-toggle w-100" data-bs-toggle="dropdown"
                            aria-expanded="false">
                            Điện thoại, Tablet
                        </button>
                        <ul class="dropdown-menu" id="categorySidebar">
                            <!-- Các danh mục sẽ được tải động từ API -->
                        </ul>
                    </div>
                    <button type="button" class="btn btn-light w-100">Laptop</button>
                    <button type="button" class="btn btn-light w-100">Âm thanh</button>
                    <button type="button" class="btn btn-light w-100">Đồng hồ, Camera</button>
                    <button type="button" class="btn btn-light w-100">Đồ gia dụng</button>
                    <button type="button" class="btn btn-light w-100">Phụ kiện</button>
                    <button type="button" class="btn btn-light w-100">PC, Màn hình, Máy in</button>
                    <button type="button" class="btn btn-light w-100">Tivi</button>
                    <button type="button" class="btn btn-light w-100">Thu cũ đổi mới</button>
                    <button type="button" class="btn btn-light w-100">Hàng cũ</button>
                    <button type="button" class="btn btn-light w-100">Khuyến mãi</button>
                    <button type="button" class="btn btn-light w-100">Tin công nghệ</button>
                </div>
            </div>

            <!-- Center Carousel -->
            <div class="center-carousel">
                <div id="carouselExampleIndicators" class="carousel slide" data-bs-ride="carousel">
                    <div class="carousel-indicators">
                        <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="0"
                            class="active" aria-current="true" aria-label="Slide 1"></button>
                        <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="1"
                            aria-label="Slide 2"></button>
                        <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="2"
                            aria-label="Slide 3"></button>
                    </div>
                    <div class="carousel-inner">
                        <div class="carousel-item active">
                            <img src="images/nang-cap-ipone-performance-15-8.webp" class="d-block w-100" alt="...">
                        </div>
                        <div class="carousel-item">
                            <img src="images/samsung-fold6-km-moi-24-8-2024.webp" class="d-block w-100" alt="...">
                        </div>
                        <div class="carousel-item">
                            <img src="images/vivo-v30e-home-thang8.webp" class="d-block w-100" alt="...">
                        </div>
                    </div>
                    <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleIndicators"
                        data-bs-slide="prev">
                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                        <span class="visually-hidden">Previous</span>
                    </button>
                    <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleIndicators"
                        data-bs-slide="next">
                        <span class="carousel-control-next-icon" aria-hidden="true"></span>
                        <span class="visually-hidden">Next</span>
                    </button>
                </div>
                <div class="additional-images">
                    <div class="top-image mt-2">
                        <img src="images/1200x150-1199x150-1.png" class="d-block w-100" alt="...">
                    </div>
                    <div class="bottom-image mt-2">
                        <img src="images/b2s-update-19-06 (1).gif" class="d-block w-100" alt="...">
                    </div>
                </div>
            </div>

            <!-- Right Images -->
            <div class="right-images">
                <div class="mb-2">
                    <img src="images/m55-cate-gia-hotsale-moi-10990.webp" class="img-fluid" alt="...">
                </div>
                <div class="mb-2">
                    <img src="images/right-banner-macbook-cto-09-08-new-new.webp" class="img-fluid" alt="...">
                </div>
                <div class="mb-2">
                    <img src="images/b2s-2024-right-banner-laptop.webp" class="img-fluid" alt="...">
                </div>
            </div>
        </div>
    </div>

    <!-- Sản phẩm mới về -->
    <div class="container mt-5">
        <h2 class="text-center font-weight-bold">Sản phẩm mới về</h2>
        <div class="row justify-content-center" id="product-list">
            <!-- Sản phẩm sẽ được tải động từ API -->
        </div>
    </div>

    <!-- Category-wise Product Sections -->
    <div class="container mt-5" id="category-products">
        <!-- Các sản phẩm theo danh mục sẽ được tải động từ API -->
    </div>

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <!-- Popper.js -->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.2/dist/umd/popper.min.js"></script>
    <!-- Bootstrap JS -->
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Custom Script -->
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            fetchProducts();
            fetchCategories();
        });
        function fetchProducts() {
        fetch('http://localhost:5000/api/products/public', {
        method: 'GET',
        headers: {
            'Content-Type': 'application/json',
        }
    })
    .then(response => response.json())
    .then(products => {
        const productList = document.getElementById('product-list');
        productList.innerHTML = '';

        const sortedProducts = products.sort((a, b) => {
            return parseInt(b._id.substring(0, 8), 16) - parseInt(a._id.substring(0, 8), 16);
        });

        const recentProducts = sortedProducts.slice(0, 12);

        recentProducts.forEach(product => {
            const productCard = `
            <div class="col-md-2 mb-4">
                <div class="card h-100">
                    <div class="position-relative">
                        <img src="${product.images[0]}" class="card-img-top" alt="${product.name}" onclick="showLoginAlert()">
                        <i class="fas fa-cart-plus position-absolute top-0 end-0 m-2" style="cursor:pointer;" onclick="addToCart('${product._id}')"></i>
                    </div>
                    <div class="card-body">
                        <h5 class="card-title">${product.name}</h5>
                        <p class="card-text product-price">${product.price}đ</p>
                    </div>
                </div>
            </div>`;
            productList.insertAdjacentHTML('beforeend', productCard);
        });
    })
    .catch(error => console.error('Error fetching products:', error));
}

// Hàm hiển thị thông báo yêu cầu đăng nhập
function showLoginAlert() {
    alert('Vui lòng đăng nhập để xem chi tiết sản phẩm.');
}
        function fetchCategories() {
            fetch('http://localhost:5000/api/categories/public', {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                }
            })
            .then(response => response.json())
            .then(categories => {
                const categoryMenu = document.getElementById('categoryMenu');
                const categorySidebar = document.getElementById('categorySidebar');
                const categoryProducts = document.getElementById('category-products');
                categoryMenu.innerHTML = '';
                categorySidebar.innerHTML = '';
                categoryProducts.innerHTML = '';

                categories.forEach(category => {
                    // Thêm danh mục vào dropdown và sidebar
                    const categoryItem = `<li><a class="dropdown-item" href="#">${category.name}</a></li>`;
                    categoryMenu.insertAdjacentHTML('beforeend', categoryItem);
                    categorySidebar.insertAdjacentHTML('beforeend', categoryItem);

                    // Fetch sản phẩm cho từng danh mục
                    fetch(`http://localhost:5000/api/products/public/category/${category._id}`, {
                        method: 'GET',
                        headers: {
                            'Content-Type': 'application/json',
                        }
                    })
                    .then(response => response.json())
                    .then(products => {
                        if (products.length > 0) {
                            const categorySection = `
                            <div class="category-section">
                                <h3>${category.name}</h3>
                                <div class="row">
                                    ${products.map(product => `
                                        <div class="col-md-2 mb-4">
                                            <div class="card h-100">
                                                <div class="position-relative">
                                                    <img src="${product.images[0]}" class="card-img-top" alt="${product.name}" onclick="showLoginAlert()">
                                                    <i class="fas fa-cart-plus position-absolute top-0 end-0 m-2" style="cursor:pointer;" onclick="addToCart('${product._id}')"></i>
                                                </div>
                                                <div class="card-body">
                                                    <h5 class="card-title">${product.name}</h5>
                                                    <p class="card-text product-price">${product.price}đ</p>
                                                    <div class="d-flex justify-content-center align-items-center">
                                                        <button class="btn btn-outline-secondary btn-sm" onclick="decrementQuantity('${product._id}')">-</button>
                                                        <input type="number" class="form-control mx-2 text-center" id="quantity-${product._id}" value="1" min="1" style="width: 50px;">
                                                        <button class="btn btn-outline-secondary btn-sm" onclick="incrementQuantity('${product._id}')">+</button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>`;
                            categoryProducts.insertAdjacentHTML('beforeend', categorySection);
                        }
                    });
                });
            })
            .catch(error => console.error('Lỗi tải danh mục:', error));
        }

        document.querySelector('.search-bar input').addEventListener('input', function(event) {
    const keyword = this.value.trim();
    if (keyword) {
        searchProducts(keyword);
    } else {
        hideSearchDropdown(); 
    }
});

// Hàm tìm kiếm sản phẩm và hiển thị kết quả dưới dạng dropdown
function searchProducts(keyword) {
    fetch(`http://localhost:5000/api/products/search?keyword=${encodeURIComponent(keyword)}`, {
        method: 'GET',
        headers: {
            'Content-Type': 'application/json'
        }
    })
    .then(response => response.json())
    .then(products => {
        const searchDropdown = document.getElementById('search-dropdown');
        searchDropdown.innerHTML = ''; // Xóa kết quả hiện tại

        if (products.length === 0) {
            searchDropdown.innerHTML = '<li class="dropdown-item">Không tìm thấy sản phẩm nào.</li>';
            searchDropdown.style.display = 'block';
            return;
        }

        // Hiển thị kết quả sản phẩm dạng dropdown
        products.forEach(product => {
            const productItem = `
            <li class="dropdown-item" onclick="showLoginAlert()">
                <img src="${product.images[0]}" alt="${product.name}" style="width: 30px; height: 30px; margin-right: 10px;">
                ${product.name} - ${product.price}đ
            </li>`;
            searchDropdown.insertAdjacentHTML('beforeend', productItem);
        });

        searchDropdown.style.display = 'block';
    })
    .catch(error => console.error('Error searching products:', error));
}

// Hàm ẩn dropdown tìm kiếm
function hideSearchDropdown() {
    const searchDropdown = document.getElementById('search-dropdown');
    searchDropdown.style.display = 'none';
}

document.addEventListener('click', function(event) {
    const searchDropdown = document.getElementById('search-dropdown');
    if (!searchDropdown.contains(event.target) && !event.target.matches('.search-bar input')) {
        hideSearchDropdown();
    }
});

    </script>
</body>

</html>
